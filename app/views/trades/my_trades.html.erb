<script type="text/javascript">
  jQuery(document).ready(function($) {
  $('a[rel*=facebox]').facebox() 
  })
</script>
<div id="main">
	<div id="my-trades">
		<h1>Your Trades</h1>

		<div class="active-trades">
			<h2>Active Trades</h2>
			<% if @trade_hash[:completed].size == 0 %>
				<p>You have no active trades.</p>
			<% else %>
        <% debugger %>
				<% @trade_hash[:completed].each do |y| %>
        <% x = y.user_need(@user.id).inventory_need %>
							<article>
							
								<h3><span>Get this book:</span> <%= x.book.name %></h3>
							    
							    <%= image_tag(x.book.thumbnail, alt: x.book.name, class: "bookcover") %>
							    
							    <div class="need-details">	
									<p><strong>Author:</strong> <%= x.book.author %><br />
									<strong>ISBN:</strong> <%= x.book.isbn %><br />
									<strong>Published:</strong> <%= x.book.published %></p>
							    </div>

							    <div class="trade-info">
					    			<p>This trade is currently active.</p>



					    			<p class="action"><%= link_to "View Trade Details", "/trade_details/" + y.id.to_s %></p>

					    			<p class="action">
					    				<%= render partial: 'change_trade_button', locals: { trade: y } %>
					    				<%= render partial: 'cancel_trade_button', locals: { trade: y } %>
					    			</p>

								</div>
							</article>
				<% end #each, trade_hash loop %>
			<% end#if %>

		</div>

		<div class="incomplete-trades">
			<% if @trade_hash[:declined].size == 0 %>
				<h2>Incomplete Trades</h2>
			<% end %>
			<% @trade_hash[:declined].each do |y| %>
      <% x = y.user_need(@user.id).inventory_need %>
						
						<article>
							<h3><span>Did not get this book:</span> <%= x.book.name %></h3>
						    
						    <%= image_tag(x.book.thumbnail, alt: x.book.name, class: "bookcover") %>

						    <div class="need-details">	
								<p><strong>Author:</strong> <%= x.book.author %><br />
								<strong>ISBN:</strong> <%= x.book.isbn %><br />
								<strong>Published:</strong> <%= x.book.published %></p>
						    </div>

						    <div class="trade-info">
				    			<p>This trade was canceled before it was completed.</p>
				    			<% #list other users involved in the trade
				    			other_trades = y.get_tradelines_except(session[:user_id])
				    			other_trades.each do |z| 
				    				if z.user_from_accepted %>
				    					<p><%= render :partial => 'users/user', locals: { display_user: z.inventory_own.user } %> has accepted this trade.</p>
				    				<% else %>
				    					<p><%= render :partial => 'users/user', locals: { display_user: z.inventory_own.user } %> was part of this trade.</p>
				    				<% end
				    			end %>

								<p class="action"><%= link_to "View Trade Details", "/trade_details/" + y.id.to_s %></p>
								<p class="action">
									<%= render partial: 'repropose_trade_button', locals: { trade: y } %>
								</p>
							</div>
						</article>
 			<% end #each, inventory_needs loop %>
 		</div>
	</div>
</div>
